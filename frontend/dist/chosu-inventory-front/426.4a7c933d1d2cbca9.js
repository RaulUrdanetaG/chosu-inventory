"use strict";(self.webpackChunkchosu_inventory_front=self.webpackChunkchosu_inventory_front||[]).push([[426],{7426:(M,m,s)=>{s.r(m),s.d(m,{UpdateItemModule:()=>S});var u=s(6814),g=s(2526),d=s(5861),r=s(95),e=s(4946),p=s(5634),f=s(6125),v=s(2381),_=s(5434);function h(n,o){1&n&&(e.TgZ(0,"div",36),e.O4$(),e.TgZ(1,"svg",37),e._UZ(2,"path",38),e.qZA()())}function T(n,o){if(1&n&&e._UZ(0,"img",39),2&n){const a=e.oxw();e.Q6J("src",a.imageSrc,e.LSH)}}function Z(n,o){1&n&&(e.TgZ(0,"label",40),e._uU(1," Actualizar imagen "),e._UZ(2,"i",41),e.qZA())}function U(n,o){1&n&&(e.TgZ(0,"label",40),e._uU(1," Cambiar imagen "),e._UZ(2,"i",41),e.qZA())}function I(n,o){if(1&n&&(e.TgZ(0,"option",42),e._uU(1),e.qZA()),2&n){const a=o.$implicit;e.s9C("value",a.tagname),e.xp6(1),e.hij(" ",a.tagname," ")}}function x(n,o){if(1&n){const a=e.EpF();e.TgZ(0,"div")(1,"div",45),e._uU(2),e.TgZ(3,"a",46),e.NdJ("click",function(){const l=e.CHM(a).$implicit,c=e.oxw(2);return e.KtG(c.onTagDelete(l))}),e._UZ(4,"i",47),e.qZA()()()}if(2&n){const a=o.$implicit;e.xp6(2),e.hij(" ",a," ")}}function b(n,o){if(1&n&&(e.TgZ(0,"div",43),e.YNc(1,x,5,1,"div",44),e.qZA()),2&n){const a=e.oxw();e.xp6(1),e.Q6J("ngForOf",a.currentTags)}}function w(n,o){if(1&n&&(e.TgZ(0,"option",42),e._uU(1),e.qZA()),2&n){const a=o.$implicit;e.s9C("value",a.owner),e.xp6(1),e.hij(" ",a.owner," ")}}function C(n,o){if(1&n&&(e.TgZ(0,"option",42),e._uU(1),e.qZA()),2&n){const a=o.$implicit;e.s9C("value",a.location),e.xp6(1),e.hij(" ",a.location," ")}}function q(n,o){1&n&&(e.TgZ(0,"p",48),e._uU(1," Por favor rellene todos los campos "),e.qZA())}function A(n,o){1&n&&(e.TgZ(0,"p",48),e._uU(1," Error al subir, intente de nuevo. "),e.qZA())}const y=function(n){return{uploading:n}},N=[{path:"",component:(()=>{var n;class o{constructor(t,i,l,c,J,Y){this.activatedRoute=t,this.itemsService=i,this.tagsService=l,this.ownersService=c,this.locationsService=J,this.router=Y,this.selectedFile=null,this.currentTags=[],this.tags=[],this.provTags=[],this.owners=[],this.locations=[],this.currentId="",this.imageSrc=null,this.isValid=!0,this.isUploading=!1,this.isUploaded=!0,this.isLoading=!1,this.itemForm=new r.cw({name:new r.NI,imagelink:new r.NI,price:new r.NI,boughtAt:new r.NI,location:new r.NI,tags:new r.NI,owner:new r.NI})}ngOnInit(){var t=this;return(0,d.Z)(function*(){t.isLoading=!0,t.tagsService.setTags(),t.ownersService.setOwners(),t.tagsService.tags$.subscribe(i=>{t.tags=t.provTags=i.filter(l=>!t.currentTags.includes(l.tagname))}),t.ownersService.owners$.subscribe(i=>{t.owners=i}),t.locations=yield t.locationsService.getLocations(),t.activatedRoute.params.subscribe(i=>{t.currentId=i.itemId}),t.itemsService.selectedItem$.subscribe(i=>{t.currentItem={...i},delete t.currentItem._id,delete t.currentItem.__v,t.itemForm.setValue(t.currentItem),t.currentTags=i.tags,t.tags=t.provTags.filter(l=>!t.currentTags.includes(l.tagname))}),t.isLoading=!1})()}onSubmit(){var t=this;return(0,d.Z)(function*(){if(t.itemForm.valid){if(t.isValid=!0,t.isUploading=!0,t.itemForm.get("tags")?.setValue(t.currentTags),null!==t.selectedFile){const l=new FormData;l.append("image",t.selectedFile);const c=yield t.itemsService.addItemImage(l);t.itemForm.get("imagelink")?.setValue(c.url)}else t.itemForm.get("imagelink")?.setValue(t.currentItem.imagelink);if((yield t.itemsService.updateItem(t.currentId,t.itemForm.value)).error)return void(t.isUploaded=!1);t.router.navigate(["/items/all"])}else t.isValid=!1})()}onTagSelect(t){this.currentTags.push(t.value),this.tags=this.provTags.filter(i=>!this.currentTags.includes(i.tagname))}onTagDelete(t){this.currentTags=this.currentTags.filter(i=>i!==t),this.tags=this.provTags.filter(i=>!this.currentTags.includes(i.tagname))}onFileSelected(t){const i=t.target.files[0];if(this.selectedFile=i,i){const l=new FileReader;l.onload=c=>{this.imageSrc=c.target.result},l.readAsDataURL(i)}}}return(n=o).\u0275fac=function(t){return new(t||n)(e.Y36(g.gz),e.Y36(p.L),e.Y36(f.i),e.Y36(v.C),e.Y36(_.a),e.Y36(g.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-update-item"]],decls:59,vars:14,consts:[[1,"flex","flex-col","items-center","justify-center","min-h-full","bg-slate-50","relative"],["class","absolute loading-svg",4,"ngIf"],["routerLink","/items/all",1,"absolute","left-3","top-2"],[1,"fa-solid","fa-arrow-left"],[1,"new-item-card","p-3","bg-white","rounded-lg","shadow-2xl","flex","flex-col","gap-2",3,"ngClass"],[1,"px-2","bg-red-600","text-white","self-end","rounded-lg",3,"click"],[1,"fa-solid","fa-trash-can"],[1,"flex","flex-col","justify-center","gap-1","new-img-container"],[1,"flex","justify-center"],["alt","Imagen Cargada","class","new-img rounded-lg",3,"src",4,"ngIf"],["for","img-input","class","bg-burnt-siena rounded-lg px-2 self-center hover:cursor-pointer hover:bg-opacity-80",4,"ngIf"],["type","file","id","img-input","accept","image/*","required","",1,"img-input",3,"change"],[1,"flex","flex-col","gap-2",3,"formGroup"],["type","hidden","formControlName","imagelink"],[1,"flex","justify-between","gap-1"],["for","name"],["type","text","formControlName","name","id","name","required","",1,"bg-gray-100","rounded-md","px-2","flex-1"],[1,"flex","gap-2"],[1,"flex","flex-col","gap-2"],["for","price"],["for","boughtAt"],[1,"flex","flex-col","flex-1","gap-2","justify-around"],[1,"flex"],["type","number","formControlName","price","id","price","min","0","required","",1,"bg-gray-100","rounded-md","px-2","flex-1"],["type","number","formControlName","boughtAt","id","boughtAt","min","0","required","",1,"bg-gray-100","rounded-md","px-2","flex-1"],[1,"flex","gap-2","items-center","justify-between"],["for","tags"],["id","tags","formControlName","tags","required","",1,"bg-gray-100","rounded-md",3,"change"],[3,"value",4,"ngFor","ngForOf"],[1,"flex","px-2","bg-green-300","rounded-lg","items-center","justify-center","hover:bg-opacity-80",3,"click"],["class","flex gap-1 mb-3 flex-wrap",4,"ngIf"],["id","owner","formControlName","owner","required","",1,"bg-gray-100","rounded-md"],["for","location"],["id","location","formControlName","location","required","",1,"bg-gray-100","rounded-md","flex-1"],["class","text-red-600",4,"ngIf"],[1,"flex","px-2","bg-blue-300","rounded-lg","items-center","justify-center","hover:bg-opacity-80",3,"click"],[1,"absolute","loading-svg"],["xmlns","http://www.w3.org/2000/svg","height","48","viewBox","0 -960 960 960","width","48",1,"animate-spin"],["d","M480-80q-84 0-157-31t-127-85q-54-54-85-127T80-480q0-84 31-157t85-127q54-54 127-85t157-31q12 0 21 9t9 21q0 12-9 21t-21 9q-141 0-240.5 99.5T140-480q0 141 99.5 240.5T480-140q141 0 240.5-99.5T820-480q0-12 9-21t21-9q12 0 21 9t9 21q0 84-31 157t-85 127q-54 54-127 85T480-80Z",1,"fill-slate-500"],["alt","Imagen Cargada",1,"new-img","rounded-lg",3,"src"],["for","img-input",1,"bg-burnt-siena","rounded-lg","px-2","self-center","hover:cursor-pointer","hover:bg-opacity-80"],[1,"fa-regular","fa-image"],[3,"value"],[1,"flex","gap-1","mb-3","flex-wrap"],[4,"ngFor","ngForOf"],[1,"flex","gap-1","items-center","p-1","rounded-lg","bg-slate-200","hover:cursor-default"],[3,"click"],[1,"fa-solid","fa-circle-xmark","text-slate-400","hover:cursor-pointer"],[1,"text-red-600"]],template:function(t,i){1&t&&(e.TgZ(0,"section",0),e.YNc(1,h,3,0,"div",1),e.TgZ(2,"button",2),e._UZ(3,"i",3),e._uU(4," Volver "),e.qZA(),e.TgZ(5,"div",4)(6,"button",5),e.NdJ("click",function(){return i.itemsService.isDeleteItemModal=!0}),e._UZ(7,"i",6),e.qZA(),e.TgZ(8,"form",7)(9,"div",8),e.YNc(10,T,1,1,"img",9),e.qZA(),e.YNc(11,Z,3,0,"label",10),e.YNc(12,U,3,0,"label",10),e.TgZ(13,"input",11),e.NdJ("change",function(c){return i.onFileSelected(c)}),e.qZA()(),e.TgZ(14,"form",12),e._UZ(15,"input",13),e.TgZ(16,"div",14)(17,"label",15),e._uU(18,"Nombre: "),e.qZA(),e._UZ(19,"input",16),e.qZA(),e.TgZ(20,"div",17)(21,"div",18)(22,"label",19),e._uU(23,"Precio: "),e.qZA(),e.TgZ(24,"label",20),e._uU(25,"Comprado en: "),e.qZA()(),e.TgZ(26,"div",21)(27,"div",22)(28,"p"),e._uU(29,"$"),e.qZA(),e._UZ(30,"input",23),e.qZA(),e.TgZ(31,"div",22)(32,"p"),e._uU(33,"$"),e.qZA(),e._UZ(34,"input",24),e.qZA()()(),e.TgZ(35,"div",25)(36,"label",26),e._uU(37,"Etiquetas: "),e.qZA(),e.TgZ(38,"select",27),e.NdJ("change",function(c){return i.onTagSelect(c.target)}),e.YNc(39,I,2,2,"option",28),e.qZA(),e.TgZ(40,"button",29),e.NdJ("click",function(){return i.tagsService.isNewTagModal=!0}),e._uU(41," Nueva etiqueta "),e.qZA()(),e.YNc(42,b,2,1,"div",30),e.TgZ(43,"div",25)(44,"label",26),e._uU(45,"Due\xf1o: "),e.qZA(),e.TgZ(46,"select",31),e.YNc(47,w,2,2,"option",28),e.qZA(),e.TgZ(48,"button",29),e.NdJ("click",function(){return i.ownersService.isNewOwnerModal=!0}),e._uU(49," Nuevo due\xf1o "),e.qZA()(),e.TgZ(50,"div",14)(51,"label",32),e._uU(52,"Ubicaci\xf3n del articulo: "),e.qZA(),e.TgZ(53,"select",33),e.YNc(54,C,2,2,"option",28),e.qZA()(),e.YNc(55,q,2,0,"p",34),e.YNc(56,A,2,0,"p",34),e.TgZ(57,"button",35),e.NdJ("click",function(){return i.onSubmit()}),e._uU(58," Editar producto "),e.qZA()()()()),2&t&&(e.xp6(1),e.Q6J("ngIf",i.isUploading||i.isLoading),e.xp6(4),e.Q6J("ngClass",e.VKq(12,y,i.isUploading||i.isLoading)),e.xp6(5),e.Q6J("ngIf",i.imageSrc),e.xp6(1),e.Q6J("ngIf",!i.imageSrc),e.xp6(1),e.Q6J("ngIf",i.imageSrc),e.xp6(2),e.Q6J("formGroup",i.itemForm),e.xp6(25),e.Q6J("ngForOf",i.tags),e.xp6(3),e.Q6J("ngIf",i.currentTags.length>0),e.xp6(5),e.Q6J("ngForOf",i.owners),e.xp6(7),e.Q6J("ngForOf",i.locations),e.xp6(1),e.Q6J("ngIf",!i.isValid),e.xp6(1),e.Q6J("ngIf",!i.isUploaded))},dependencies:[u.mk,u.sg,u.O5,g.rH,r._Y,r.YN,r.Kr,r.Fj,r.wV,r.EJ,r.JJ,r.JL,r.Q7,r.qQ,r.sg,r.u],styles:[".new-item-card[_ngcontent-%COMP%]{max-width:400px;margin-top:20px}.new-img[_ngcontent-%COMP%]{width:200px;height:300px}.img-input[_ngcontent-%COMP%]{display:none}.loading-svg[_ngcontent-%COMP%]{top:50%;left:50%;transform:translate(-50%,-50%)}.uploading[_ngcontent-%COMP%]{opacity:.1}"]}),o})()}];let F=(()=>{var n;class o{}return(n=o).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[g.Bz.forChild(N),g.Bz]}),o})(),S=(()=>{var n;class o{}return(n=o).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[u.ez,F,r.UX]}),o})()}}]);